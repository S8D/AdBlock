#!/bin/sh
dVersion="20180730h"
#__________________________________________________________________________________________________
#SubDM="\~|000webhostapp\.com$|000webhostaww\.com$|0catch\.com$|0x1f4b0\.com$|126\.net$|207\.net$|2o7\.net$|302br\.net$|360\.cn$|3g\.cn$|51yes\.com$|69server\.net$|6\.cn$|7us\.us$|ac\.cn$|actonsoftware\.com$|adaos\-ads\.net$|adap\.tv$|adbureau\.net$|adclear\.net$|adhese\.com$|adjlggler\.net$|adkmob\.com$|admob\.com$|adnxs\.com$|adotmob\.com$|adprotect\.net$|adpush\.cn$|adscience\.nl$|adsrvr\.org$|advertising\.com$|aeta.*lim\.net$|ahdoonetfisher\.net$|aitilklykk\.net$|aiziezq6\.net$|alimabi\.cn$|alimama\.cn$|allyes\.com$|alphonso\.tv$|alpol\.com$|altpool\.pro$|am15\.net$|amazon\-adsystem\.com$|analysys\.cn$|anbtr\.com$|angelfire\.com$|aobohalbirex\.net$|aplus\.net$|appier\.net$|atspace\.us$|autoimg\.cn$|aviasales\.ru$|awwier\.net$|baidu\.com$|baixeinfiltrato\.net$|beeplog\.de$|bestdeals\.at$|bizland\.com$|blog\.com$|blogswot\..*$|blueadvertise\.com$|blysellads\.com$|bpa\.nu$|bt\.net$|btcchina\.com$|btttag\.com$|bubblesmedia\.ru$|byinter\.net$|cablelink\.ro$|caiy.*ews\.net$|canalblog\.com$|carrieriq\.com$|casee\.cn$|cdi\.no$|ce.*d\-t.*ar\.com$|cedexis\.net$|centade\.com$|centerblog\.net$|chartbeat\.net$|charter\.com$|chat\.rl$|chez\.com$|chiej.*ls\.net$|china\.cn$|chinaenter\.cn$|cjb\.net$|cjt1\.net$|clan\.su$|clickability\.com$|clickbank\.net$|clicksmob\.com$|cloldfront\.net$|co\.at$|co\.cc$|co\.lk$|co\.tv$|co\.zw$|codns\.com$|coin\-have\.com$|coinblockers\.com$|com1\.ru$|com\-oo4\.net$|com\.al$|com\.br$|com\.cn$|comcast\.net$|comlu\.com$|comoj\.com$|company\-target\.com$|connextra\.com$|consensu\.org$|crashlytics\.com$|creablog\.com$|creativemedia\.buzz$|criteo\.(com|net)$|cryptaloot\.pro$|cz\.cc$|da\.ru$|ddns\.net$|de\.sr$|de\.vu$|deluxepass\.com$|demdex\.net$|demos\.su$|designmysite\.pro$|diaryland\.com$|digitalinsight\.com$|dolbleclick\.net$|domob\.cn$|doubleclick\.com$|doubleclick\.net$|dtiblog\.com$|dy4\.de$|e.*e\-of\-g.*er\.net$|e\-city\.tv$|easy4blog\.com$|ebaf.*idin\.com$|ebayrtm\.com$|ed10\.net$|edu\.cn$|eigenpage\.nl$|eiyo.*ows\.net$|eloqua\.com$|ensighten\.com$|envy\.nu$|eoc.*orks\.net$|erasercash\.com$|ero\-advertising\.com$|f3322\.net$|fastclick\.net$|fastestshopa\.su$|fasthost\.tv$|fateback\.com$|favorietje\.nl$|fgpp\.com$|films\-internet\.info$|firstfind\.nl$|firstlight\.cn$|fj\.cn$|flu\.cc$|for\-our\.info$|fora\.pl$|forum2x2\.ru$|forumtoolbar\.com$|free\.fr$|freehosting\.cc$|freesitesnetwork\.com$|frem\.com$|fwmrm\.net$|fx\.to$|gb\.net$|gerelateerd\.nl$|getrestinfom\.su$|getrestinfon\.su$|go2affise\.com$|googlesyndication\.com$|gotech\.tk$|gov\.cn$|grandenetworks\.net$|hashvault\.pro$|hatenablog\.com$|herokuapp\.com$|hi\.cn$|hienebakster\.net$|hitbox\.com$|hol\.es$|home\.ne\.jp$|hotjar\.com$|hotlinkimage\.com$|hotpaginas\.com$|httpool\.com$|huanqiu\.com$|hunantv\.com$|hut1\.ru$|hyperphp\.com$|hywerbanner\.net$|i2idata\.com$|i2iserv\.com$|i3log\.com$|i\-gloo\.net$|i\-lookup\.com$|ibelgique\.com$|iblogs\.com$|ibnsites\.com$|ibohpjavme\.com$|icast\.cn$|idv\.tw$|iedoobuzzlike\.com$|iegh.*rror\.com$|iehohicv2\.net$|iembarazadas\.com$|iequutravel4u\.com$|ieyipluckyscent\.com$|ifeng\.com$|ifengimg\.com$|ifrance\.com$|igexin\.com$|ign\.com$|ignorelist\.com$|igodigital\.com$|ihielatelevisao\.com$|iiniamoca\-news\.com$|ijijiji\.com$|ijinshan\.com$|iknowthatgirl\.com$|ikwilhet\.nu$|impact\-ad\.jp$|imrworldwide\.com$|indieclick\.com$|indymedia\.org$|infoweb\.ne\.jp$|inq\.com$|insightfirst\.com$|installantivirus\.us$|isgre\.at$|ixa.*sts\.net$|jl\.cn$|jpush\.cn$|jtle0\.cn$|kla.*and\.nl$|klan.*land\.com$|krovatka\.su$|l\-telcom\.net$|lab.*ining\.com$|land\.ru$|level3\.net$|linkexchange\.nl$|linkgoed\.nl$|linkhotel\.nl$|linkpulse\.com$|liuliangbao\.cn$|liveadvert\.com$|lmbler\.net$|localytics\.com$|loizuseolita\.com$|lookingat\.us$|lookseekpages\.com$|looksmart\.com$|loomia\.com$|looq.*ciety\.com$|loyaltytoolbar\.com$|lphbs\.com$|lsercash\.com$|ltHosts\.com$|lycos\.com$|mabulle\.com$|madvertise\.com$|maxthon\.cn$|mchsi\.com$|media\-toolbar\.com$|mediaonenetwork\.net$|meegmfio\.in$|mesh\.ad\.jp$|microad\.jp$|minemonero\.pro$|minerhills\.com$|minertopia\.org$|miningpoolhub\.com$|minisplat\.cn$|mirtesen\.rl$|mktoresp\.com$|moad\.cn$|mob\.com$|mobileapptracking\.com$|mobilecore\.com$|mobiletheory\.com$|mobpartner\.com$|mocean\.mobi$|mojeforlm\.net$|monerise\.com$|musicfrost\.com$|my.*toolbar\.com$|my\-place\.us$|mybjjblog\.com$|mydas\.mobi$|myhomescreen\.tv$|myjino\.ru$|mylivepage\.ru$|mylivewage\.rl$|myway\.com$|n3\.net$|nanopool\.org$|narod2\.ru$|narod\.ru$|nat.*orks\.ru$|nedstat\.net$|neliver\.com$|net16\.net$|net23\.net$|net46\.net$|net63\.net$|net76\.net$|net78\.net$|net84\.net$|net\.cn$|netpass\.tv$|netshelter\.net$|nnarod\.ru$|nu.*e\-cr.*t\.net$|nut\.cc$|nx\.cn$|oasuagoals\.net$|oboh.*avi\.net$|oewabox\.at$|ohx.*all\.net$|onion\.to$|online\-metrix\.net$|onlinepricex\.su$|ono\.com$|ontheweb\.nl$|ooroptiobeto\.net$|oowaividaddict\.net$|openxenterprise\.com$|org\.cn$|ourtoolbar\.com$|owentracker\.net$|pacbell\.net$|pagina\.nu$|peiw.*es\.com$|pinba.*twork\.com$|plp7\.ru$|plugrush\.com$|pma\-network\.com$|pointroll\.com$|polarmobile\.com$|poloniex\.com$|polyad\.net$|polybuild\.ru$|popads\.net$|pornhub\.com$|publicus\.com$|puserving\.com$|qq\.com$|qualtrics\.com$|queroumforum\.com$|raeniretweet\.net$|reporo\.net$|rfihub\.com$|rr\.com$|rr\.nu$|rubiconproject\.com$|s.*e\-dir.*y\.net$|sbcglobal\.net$|scorecardresearch\.com$|searchmiracle\.com$|searchwho\.com$|sec.*ctrade\.ru$|seclrenet\-server\.net$|seclreserver\.net$|secureintl\.com$|ser.*rike\.com$|serving\-sys\.com$|sextracker\.de$|shaeyffh6\.net$|sharezips\.net$|shoofle\.tv$|shuzilm\.cn$|si.*fe\-hi.*ce\.gq$|sina\.cn$|sinaimg\.cn$|site40\.net$|site50\.net$|site88\.net$|site90\.com$|site90\.net$|skyrock\.com$|smaato\.net$|smartnaturalshop\.su$|smi2\.net$|smi2\.ru$|soarfi\.cn$|solocwm\.com$|solt.*ale\.com$|soothxopso\.net$|spacevilla\.net$|sponsormob\.com$|spylog\.com$|spywarestrike\.com$|startclub\.nl$|startmee\.nl$|startspot\.nl$|startswot\.nl$|startvista\.nl$|startvriend\.nl$|student\-24\.ru$|subito\.cc$|suprnova\.cc$|switchadhub\.com$|syndicaster\.tv$|szm\.com$|t\-online\.hl$|taboola\.com$|tahc.*eks\.net$|taiwabonlswinner\.net$|teads\.tv$|tealilmiq\.com$|telekom\.hu$|telering\.at$|terrashare\.com$|theglobeandmail\.com$|thetrafficstat\.net$|thohjkuvat\.net$|tianya\.cn$|tie\.cl$|tlmblr\.com$|tmall\.com$|tmfweb\.nl$|tomshardware\.com$|top100\.org$|toprealsalen\.su$|tpnet\.pl$|tr.*ut\-t.*e\.org$|trademob\.com$|tsx\.org$|tvgoods\.ru$|twnet\.wl$|uc\.cn$|ucoz\.ru$|ufanet\.ru$|uni5\.net$|uni\.cc$|usite\.pro$|valleclick\.com$|valleclick\.net$|vectranet\.pl$|vertamedia\.com$|veruta\.com$|vi\.net$|videoplaza\.tv$|vidible\.tv$|vidzi\.tv$|voiceads\.cn$|voicecloud\.cn$|voluumtrk2\.com$|voluumtrk3\.com$|voluumtrk\.com$|vsn\.nu$|w8w\.pl$|waligrucha\.pl$|warszawa\.pl$|waw\.pl$|wbwhgwbr\.in$|web\.tr$|webgidsje\.nl$|webjump\.com$|webservis\.ru$|website\.pl$|webtradeplus\.su$|webtrekk\.net$|webwise\.com$|wechat\.com$|weebly\.com$|weibo\.cn$|weibo\.com$|wirtualnie\.pl$|wlblicvm\.com$|work5\.ru$|wostore\.cn$|wow\-hosting\.com$|woxaeoboads\.com$|woyo8g\.com$|wps\.cn$|wrating\.com$|wtcsites\.com$|wxv\.pl$|x10host\.com$|x10hosting\.com$|x2z\.com$|xae.*is\.com$|xanga\.com$|xbloggers\.com$|xblogspot\.com$|xg4ken\.com$|xhamster\.com$|xiaocen\.com$|xiaomi\.com$|xiti\.com$|xj\.cn$|xlogz\.com$|xmatch\.com$|xmiler\.com$|xooit\.com$|xrus\.org$|xxxfaster\.net$|xz\.cn$|yamanoha\.com$|yesadvertising\.com$|yi\.org$|yieldmanager\.net$|yoyohost\.com$|zac.*ella\.net$|zapto\.org$|zeblog\.com$|zinoiosijek031\.net$|zj\.cn$|zrus\.org$|zz\.mu$";
#grep -vE "(${SubDM})" | 
SedX="s|#.*$||; s|<.*$||; s|::||; s|^address=/||; s|0.0.0.0||; s|:.*$||; s|^127.0.0.1||; s|^255.255.*||; s|0.0.0.0||; s|\/$||; s|\.$||; s|^[[:space:]]*||g; s|\;|\n|; s|\s+$||; s|\^$||; s|^\-\-||; s|^\-||; s|^[^.]+$||; s|&.*$||; s|^ðŸ”—||; s|^\.||; s|^\_\_||g; s|^\_||g; s|\.$||; s|\?$||; s|\-$||; s|\+$||; s|\$.*$||; s|\.v$||; s|\.w$||; s|p.*mq$||; s|\.co.*rls$|.com|; s/\.com(1|a|m|au|br|en|f4a|http|categories)$/.com/; s|[[:space:]]$||; /^$/d";
Sed00="s|!.*$||; s|#.*$||; s|:.*$||; s|\^.*$||; s|\@.*$||; s|\/.*$||; s|\?.*$||; s|.*\*.$||; s|~.*$||; s|0.0.0.0||; s|\,|\n|g; s|^127\.0\.0\.1.*$||; s/\|\|//; s|[[:blank:]]|\n|; s|^\.||; s|^[^.]+$||; s|>.*$||; s|\\.*$||; s|^\-||; s|\&.*$||; s|\*$||; s|^.*\.$||g; s|.*\*.*||; s|.*\.$||; s|\n.*\.$||";
Sed01="s|\.invalid$||; s|.*main$||; s|\.co.*orn$|.com|; s|^i.*nt$||; s|^s.*pt$||";
Sed1="s|.*ating$||; s|.*kbang$||; s|.*ztop$||; s|.*kdns$||; s|.*main$||; s|\.v.*ost$|.vn|; s|\.co.*ost$|.com|; s|\.co.*ies$|.com|; s|\.co.*orn$|.com|";
Sed2="s|\.$||; s|\.k$||; s|\.co.*orn$|.com|; s|www$||";
Sed3="s|\.com.*orn$|.com|; s|^w.*orn$||; s|.*html$||";
Sed4="s|\.z$||; s|\.com.*orn$|.com|; s|^w.*orn$||; s|\/.*ads$||";
SedY="s|^[^.]+$||; /^$/d"
Dl="${TMuc}/dl";
if [ -f "${TMuc}/Location" ];then
	rm -rf ${Dl};mkdir ${Dl};
fi
QUIET="0"
#__________________________________________________________________________________________________
InRa ()
{
	[ $QUIET -eq 0 ] && echo "$1"
	echo "$1" >> $hLog
}
Size ()
{
	InRa "`du -h $1 | awk '{print $1}'`"
}
#__________________________________________________________________________________________________
#InRa "> Running $dVersion";
if [ -f $Lv0 ];then
	InRa "> Compacting [0] ...";
	LC_ALL=C cat $Lv0 | sed -r "${SedX}" | sed -r "${SedY}" | awk '{if ($1 in a) next; a[$1]=$0; print}' > $tam;InRa ">> Compacted [0]: $(Size "$tam")";cat $tam > $hTam;
	if [ -f "${TMuc}/Location" ];then
		cp $Lv0 ${Dl}/_Lv0.txt; cp $tam ${Dl}/Lv0.txt;
	fi
	rm -f $Lv0;
fi
if [ -f $Lv00 ];then
	InRa "> Compacting [0.5] ...";
	LC_ALL=C cat $Lv00 | tr '[:upper:]' '[:lower:]' | sed -r "${SedX}" | sed -r "${Sed00}" | sed -r "${Sed01}" | sed 's|\$.*$||' | grep -o '^[^|]*' | awk '{if ($1 in a) next; a[$1]=$0; print}' > $tam;InRa ">> Compacted [0.5]: $(Size "$tam")";cat $tam >> $hTam;
	if [ -f "${TMuc}/Location" ];then
		cp $Lv00 ${Dl}/_Lv00.txt; cp $tam ${Dl}/Lv00.txt;
	fi
	rm -f $Lv00;
fi
if [ -f $Lv1 ];then
	InRa "> Compacting [1] ...";
	LC_ALL=C cat $Lv1 | sed -r "${SedX}" | sed -r "${Sed1}" | sed -r "${SedY}" | awk '{if ($1 in a) next; a[$1]=$0; print}' > $tam;InRa ">> Compacted [1]: $(Size "$tam")";cat $tam >> $hTam;
	if [ -f "${TMuc}/Location" ];then
		cp $Lv1 ${Dl}/_Lv1.txt; cp $tam ${Dl}/Lv1.txt;
	fi
	rm -f $Lv1;
fi
if [ -f $Lv2 ];then
	InRa "> Compacting [2] ...";
	LC_ALL=C cat $Lv2 | sed -r "${SedX}" | sed -r "${Sed2}" | sed -r "${SedY}" | awk '{if ($1 in a) next; a[$1]=$0; print}' > $tam;InRa ">> Compacted [2]: $(Size "$tam")";cat $tam >> $hTam;
	if [ -f "${TMuc}/Location" ];then
		cp $Lv2 ${Dl}/_Lv2.txt; cp $tam ${Dl}/Lv2.txt;
	fi
	rm -f $Lv2;
fi
if [ -f $Lv3 ];then
	InRa "> Compacting [3] ...";
	LC_ALL=C cat $Lv3 | tr '[:upper:]' '[:lower:]' | sed -r "${SedX}" | sed -r "${Sed3}" | sed -r "${SedY}" | awk '{if ($1 in a) next; a[$1]=$0; print}' > $tam;InRa ">> Compacted [3]: $(Size "$tam")";cat $tam >> $hTam;
	if [ -f "${TMuc}/Location" ];then
		cp $Lv3 ${Dl}/_Lv3.txt; cp $tam ${Dl}/Lv3.txt;
	fi
	rm -f $Lv3;
fi
if [ -f $Lv4 ];then
	InRa "> Compacting [4] ...";
	LC_ALL=C cat $Lv4 | tr '[:upper:]' '[:lower:]' | sed -r "${SedX}" | sed -r "${Sed4}" | sed -r "${SedY}" | awk '{if ($1 in a) next; a[$1]=$0; print}' > $tam;InRa ">> Compacted [4]: $(Size "$tam")";cat $tam >> $hTam;
	if [ -f "${TMuc}/Location" ];then
		cp $Lv4 ${Dl}/_Lv4.txt; cp $tam ${Dl}/Lv4.txt;
	fi
	#rm -f $Lv4;
fi
